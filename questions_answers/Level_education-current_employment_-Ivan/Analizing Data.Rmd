
```{r}
library(dplyr)
library(ggplot2)
```


```{r}
data <- read.csv("variables_zp.rds")
```


```{r}
#26 variables
selected_data <- data
head(selected_data)
```



```{r}

edu_decode_Ja <- function(df, column_name) {
  df %>%
    mutate(!!sym(column_name) := case_when(
      !!sym(column_name) == 0 ~ "Nein",
      !!sym(column_name) == 1 ~ "Ja",
      TRUE ~ as.numeric(!!sym(column_name))
    ))
}


columns_to_decode <- c(
                       "CURRACTIVITY_FULL", "CURRACTIVITY_PART",
                       "CURRACTIVITY_HOME","IN_EDUCATION")

decoded_data <- data
for (col in columns_to_decode) {
  decoded_data <- edu_decode_Ja(decoded_data, col)
}
```




```{r}
decoded_data <- decoded_data %>%
  mutate(
    CURRACTIVITYSTATUSIII = case_when(
      CURRACTIVITYSTATUSIII == 1 ~ "Vollzeiterwerbstätige (90-100%)",
      CURRACTIVITYSTATUSIII == 2 ~ "Teilzeiterwerbstätige I (70-89%)",
      CURRACTIVITYSTATUSIII == 3 ~ "Teilzeiterwerbstätige II (50-69%)",
      CURRACTIVITYSTATUSIII == 4 ~ "Teilzeiterwerbstätige III (<50%)",
      CURRACTIVITYSTATUSIII == 5 ~ "Erwerbslose",
      CURRACTIVITYSTATUSIII == 6 ~ "In Ausbildung",
      CURRACTIVITYSTATUSIII == 7 ~ "Hausfrauen/Hausmänner",
      CURRACTIVITYSTATUSIII == 8 ~ "Rentner/innen",
      CURRACTIVITYSTATUSIII == 9 ~ "Andere Nichterwerbspersonen",
      TRUE ~ as.character(CURRACTIVITYSTATUSIII)
    ),
    HIGHESTCOMPLEDUAGGI = case_when(
      HIGHESTCOMPLEDUAGGI == 1 ~ "Sekundarstufe 1",
      HIGHESTCOMPLEDUAGGI == 2 ~ "Sekundarstufe 2",
      HIGHESTCOMPLEDUAGGI == 3 ~ "Tertiärstufe",
      TRUE ~ as.character(HIGHESTCOMPLEDUAGGI)
    ),
    HIGHESTCOMPLEDU = case_when(
      HIGHESTCOMPLEDU == 1 ~ "keine",
      HIGHESTCOMPLEDU == 2 ~ "Bis max. 7 Jahre obligatorische Schule",
      HIGHESTCOMPLEDU == 3 ~ "Obligatorische Schule (Real-, Sekundar-, Bezirks-, Orientierungsschule, Pro-, Untergymnasium, Sonderschule)",
      HIGHESTCOMPLEDU == 4 ~ "1-jährige Vorlehre, 1-jährige allgemeinbildende Schule, 10. Schuljahr, 1-jährige Berufswahlschule, Haushaltslehrjahr, Sprachschule (mind. 1 Jahr) mit Schlusszertifikat, Sozialjahr, Brückenangebote oder ähnliche Ausbildung",
      HIGHESTCOMPLEDU == 5 ~ "2- bis 3-jährige Diplommittelschule, Verkehrsschule, Fachmittelschule FMS oder ähnliche Ausbildung",
      HIGHESTCOMPLEDU == 6 ~ "Berufliche Grundbildung (Anlehre, 2- bis 4-jährige Berufslehre oder Vollzeitberufsschule, Handelsdiplom, Lehrwerkstätte oder ähnliche Ausbildung)",
      HIGHESTCOMPLEDU == 7 ~ "Gymnasiale Maturität, Lehrkräfte-Seminar (vorbereitende Ausbildung für Lehrkräfte von Kindergarten, Primarschule, Handarbeit, Hauswirtschaft)",
      HIGHESTCOMPLEDU == 8 ~ "Berufs- oder Fachmaturität",
      HIGHESTCOMPLEDU == 9 ~ "Höhere Fach- und Berufsausbildung mit eidg. Fachausweis, eidg. Diplom oder Meisterprüfung, höhere Fachschule für Technik (Technikerschule TS), für Wirtschaft (HKG) oder ähnliche höhere Fachschule (2 Jahre Voll- oder 3 Jahre Teilzeitstudium)",
      HIGHESTCOMPLEDU == 10 ~ "Höhere Fachschule (Vorgänger von Fachhochschulen, z.B. HTL, HWV, HFG, HFS) inkl. Nachdiplome (3 Jahre Voll- oder 4 Jahre Teilzeitstudium)",
      
  )

```


```{r}
head(decoded_data)
```


```{r}
decoded_data <- decoded_data %>%
  filter(if_all(everything(), ~ . != "-9"))

```


```{r}
table(decoded_data$HIGHESTCOMPLEDUAGGI)
```

```{r}

employment_data <- decoded_data %>%
  filter(!is.na(HIGHESTCOMPLEDUAGGI), CURRACTIVITYSTATUSI == "Erwerbstätige") %>% 
  group_by(HIGHESTCOMPLEDUAGGI) %>%
  summarise(
    total = n(),
    employed = sum(CURRACTIVITY_FULL == "Ja", na.rm = TRUE), 
    employment_rate = (employed / total) * 100 
  ) %>%
  arrange(desc(employment_rate))


ggplot(employment_data, aes(x = reorder(HIGHESTCOMPLEDUAGGI, -employment_rate), y = employment_rate)) +
  geom_bar(stat = "identity", fill = "steelblue") +
  labs(
    title = "Корреляция между уровнем образования и процентом занятости",
    x = "Level of education",
    y = "employement (%)"
  ) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) 
```
```{r}
employment_type_data <- decoded_data %>%
  filter(!is.na(HIGHESTCOMPLEDUAGGI)) %>%
  mutate(employment_type = case_when(
    CURRACTIVITY_FULL == "Ja" ~ "Полная занятость",
    CURRACTIVITY_PART == "Ja" ~ "Частичная занятость",
    CURRACTIVITY_MULTI == "Ja" ~ "Несколько работ",
    TRUE ~ "Нет занятости"
  )) %>%
  group_by(HIGHESTCOMPLEDUAGGI, employment_type) %>%
  summarise(count = n()) %>%
  mutate(percentage = count / sum(count) * 100)

ggplot(employment_type_data, aes(x = HIGHESTCOMPLEDUAGGI, y = percentage, fill = employment_type)) +
  geom_bar(stat = "identity", position = "fill") +
  labs(
    title = "Распределение типов занятости по уровням образования",
    x = "Уровень образования",
    y = "Процент",
    fill = "Тип занятости"
  ) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```


```{r}
student_data <- decoded_data %>%
  filter(!is.na(HIGHESTCOMPLEDUAGGI)) %>%
  group_by(HIGHESTCOMPLEDUAGGI) %>%
  summarise(
    total = n(),
    students = sum(CURRACTIVITY_STUDENT == "Ja", na.rm = TRUE),
    student_rate = (students / total) * 100
  )

ggplot(student_data, aes(x = student_rate, y = reorder(HIGHESTCOMPLEDUAGGI, student_rate))) +
  geom_point(size = 3, color = "darkgreen") +
  labs(
    title = "Уровень образования и процент студентов",
    x = "Процент студентов",
    y = "Уровень образования"
  ) +
  theme_minimal()
```

```{r}
ggplot(decoded_data %>% filter(!is.na(HIGHESTCOMPLEDUAGGI), CURRACTIVITY_FULL == "Ja"), 
       aes(x = HIGHESTCOMPLEDUAGGI)) +
  geom_density(aes(fill = HIGHESTCOMPLEDUAGGI), alpha = 0.5) +
  labs(
    title = "Плотность полной занятости по уровням образования",
    x = "Уровень образования",
    y = "Плотность"
  ) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

```{r}
employment_count <- decoded_data %>%
  filter(!is.na(HIGHESTCOMPLEDUAGGI)) %>%
  mutate(employment_status = case_when(
    CURRACTIVITY_FULL == "Ja" ~ "Полная занятость",
    CURRACTIVITY_PART == "Ja" ~ "Частичная занятость",
    CURRACTIVITY_DISOCC == "Ja" ~ "Безработные",
    TRUE ~ "Другие"
  ))

ggplot(employment_count, aes(x = HIGHESTCOMPLEDUAGGI, fill = employment_status)) +
  geom_bar(position = "dodge") +
  labs(
    title = "Распределение типов занятости по уровням образования",
    x = "Уровень образования",
    y = "Количество людей",
    fill = "Тип занятости"
  ) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

